<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../styles/common.css" />
    <link rel="stylesheet" href="../styles/buscadorEP.css" />
    <title>Upload de planilhas</title>
  </head>

  <body>
    <main class="buscador-wrapper" role="main">
      <!-- Buscador de EP (conteúdo central) -->
      <section class="ep-page" aria-label="Buscador de EP">
        <div class="ep-card">
          <header class="ep-card__header">
            <div></div>

            <h1 class="ep-title">Buscador de EP</h1>

          </header>

          <div class="ep-card__body">
            <div class="ep-grid">
              <!-- COLUNA ESQUERDA -->
              <section class="ep-panel" aria-label="Planilha de base">
                <header class="ep-panel__header">
                  <h2 class="ep-panel__title">Planilha de base</h2>

                  <button id="btnLimparBase" class="ep-btn ep-btn--ghost" type="button">
                    Limpar
                  </button>
                </header>

                <div class="ep-field">
                  <label class="ep-label" for="inputBasePath">Arquivo base</label>

                  <div class="ep-input-row">
                    <input
                      id="inputBasePath"
                      class="ep-input"
                      type="text"
                      placeholder="Selecione a planilha base (.xlsx / .csv)"
                      readonly
                    />

                    <button
                      id="btnSelecionarBase"
                      class="ep-icon-btn"
                      type="button"
                      aria-label="Selecionar arquivo base"
                      title="Selecionar arquivo base"
                    >
                      <!-- ícone pasta (inline svg) -->
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M10 4l2 2h8a2 2 0 012 2v1H2V6a2 2 0 012-2h6zm12 6v10a2 2 0 01-2 2H4a2 2 0 01-2-2V10h20z"
                        />
                      </svg>
                    </button>
                  </div>

                  <p class="ep-help">
                    A planilha “base” é a referência principal (onde estão seus EPs/itens).
                  </p>
                </div>

                <div class="ep-preview" role="region" aria-label="Prévia da planilha base">
                  <div class="ep-preview__head">Prévia da planilha</div>

                  <div id="previewBase" class="ep-preview__body">
                    <div class="ep-empty">
                      <div class="ep-empty__title">Nenhum arquivo carregado</div>
                      <div class="ep-empty__subtitle">
                        Selecione uma planilha para visualizar as primeiras linhas.
                      </div>
                    </div>

                    <!-- Exemplo de tabela (remova quando for renderizar via JS) -->
                    <!--
                    <table class="ep-table">
                      <thead>
                        <tr>
                          <th>Código</th>
                          <th>Descrição</th>
                          <th>NCM</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>EP001</td>
                          <td>Produto exemplo...</td>
                          <td>1234.56.78</td>
                        </tr>
                      </tbody>
                    </table>
                    -->
                  </div>
                </div>
              </section>

              <!-- COLUNA DIREITA -->
              <section class="ep-panel" aria-label="Planilha de busca">
                <header class="ep-panel__header">
                  <h2 class="ep-panel__title">Planilha de busca</h2>

                  <button id="btnLimparBusca" class="ep-btn ep-btn--ghost" type="button">
                    Limpar
                  </button>
                </header>

                <div class="ep-field">
                  <label class="ep-label" for="inputBuscaPath">Arquivo de busca</label>

                  <div class="ep-input-row">
                    <input
                      id="inputBuscaPath"
                      class="ep-input"
                      type="text"
                      placeholder="Selecione a planilha de busca (.xlsx / .csv)"
                      readonly
                    />

                    <button
                      id="btnSelecionarBusca"
                      class="ep-icon-btn"
                      type="button"
                      aria-label="Selecionar arquivo de busca"
                      title="Selecionar arquivo de busca"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M10 4l2 2h8a2 2 0 012 2v1H2V6a2 2 0 012-2h6zm12 6v10a2 2 0 01-2 2H4a2 2 0 01-2-2V10h20z"
                        />
                      </svg>
                    </button>
                  </div>

                  <p class="ep-help">
                    A planilha “busca” é a que você quer consultar/comparar contra a base.
                  </p>
                </div>

                <div class="ep-preview" role="region" aria-label="Prévia da planilha de busca">
                  <div class="ep-preview__head">Prévia da planilha</div>

                  <div id="previewBusca" class="ep-preview__body">
                    <div class="ep-empty">
                      <div class="ep-empty__title">Nenhum arquivo carregado</div>
                      <div class="ep-empty__subtitle">
                        Selecione uma planilha para visualizar as primeiras linhas.
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            </div>

            <!-- Barra inferior (no padrão do app) -->
            <div class="ep-footer-bar">
            <!-- lado esquerdo: pasta de saída -->
            <div class="ep-footer-left">
              <div class="ep-field">
                <label class="ep-label" for="inputSaidaPath">Pasta de saída</label>

                <div class="ep-input-row">
                  <input
                    id="inputSaidaPath"
                    class="ep-input"
                    type="text"
                    placeholder="Selecione a pasta de saída"
                    readonly
                  />

                  <button
                    id="btnSelecionarSaida"
                    class="ep-icon-btn"
                    type="button"
                    aria-label="Selecionar pasta de saída"
                    title="Selecionar pasta de saída"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M10 4l2 2h8a2 2 0 012 2v1H2V6a2 2 0 012-2h6zm12 6v10a2 2 0 01-2 2H4a2 2 0 01-2-2V10h20z"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- lado direito: ações -->
            <div class="ep-footer-actions">
              <button id="btnLimparTudo" class="ep-btn ep-btn--outline" type="button">
                Limpar tudo
              </button>

              <button id="btnExecutarBusca" class="ep-btn ep-btn--primary" type="button">
                Executar busca
              </button>
            </div>
          </div>

          </div>
        </div>
      </section>

    </main>

    <!-- Overlay de loading / progresso -->
    <div id="epLoadingOverlay" class="ep-loading ep-hidden" role="dialog" aria-modal="true">
    <div class="ep-loading__card">
      <div class="ep-loading__title">Processando…</div>
      <div id="epLoadingMsg" class="ep-loading__msg">Iniciando…</div>

      <div class="ep-loading__bar">
        <div id="epLoadingBar" class="ep-loading__barFill" style="width: 0%"></div>
      </div>

      <div class="ep-loading__meta">
        <span id="epLoadingPct">0%</span>
        <span id="epLoadingReq"></span>
      </div>

      <!-- NOVO: botão cancelar -->
      <div class="ep-loading__actions">
        <button id="epCancelBtn" class="expo8-cancel-btn" type="button">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de resultado (sucesso/erro/cancelado) -->
  <div id="epResultModal" class="ep-modal ep-hidden" role="dialog" aria-modal="true" aria-label="Resultado do processamento">
    <div class="ep-modal__card">
      <div class="ep-modal__head">
        <div id="epResultIcon" class="ep-modal__icon" aria-hidden="true">✓</div>

        <div class="ep-modal__titles">
          <div id="epResultTitle" class="ep-modal__title">Concluído</div>
          <div id="epResultSubtitle" class="ep-modal__subtitle">Arquivo salvo com sucesso.</div>
        </div>

        <button id="epResultCloseX" class="ep-modal__close" type="button" aria-label="Fechar">✕</button>
      </div>

      <div class="ep-modal__body">
        <div class="ep-modal__row">
          <div class="ep-modal__label">Caminho</div>
          <div class="ep-modal__value">
            <code id="epResultPath" class="ep-modal__path">—</code>
          </div>
        </div>

        <div class="ep-modal__row ep-modal__row--log">
          <div class="ep-modal__label">Log</div>
          <pre id="epResultLog" class="ep-modal__log"></pre>
        </div>
      </div>

      <div class="ep-modal__actions">
        <button id="epResultOpenPath" class="ep-btn ep-btn--primary" type="button">
          Abrir caminho
        </button>
        <button id="epResultCopyLog" class="ep-btn ep-btn--outline" type="button">Copiar log</button>
        <button id="epResultClose" class="ep-btn ep-btn--primary" type="button">Fechar</button>
      </div>
    </div>
  </div>

    <script src="../scripts/src_buscadorEp.js"></script>
  </body>
</html>
