<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>WS VisoParser</title>
  <link rel="stylesheet" href="../styles/common.css" />
  <link rel="stylesheet" href="../styles/sty_visoparser.css" />
</head>
<body>

  <div class="main-card">
    <h2>Parser - Importação</h2>

    <div class="help-top-right">
      <button id="btnAjuda" class="btn-help" type="button" aria-label="Ajuda">
        ?
      </button>
    </div>


    <!-- Caminhos -->
    <h4>Diretório de Origem (Arquivos para leitura)</h4>
    <div class="path-row">
      <input id="entradaLabel" class="path-input" type="text" placeholder="Selecione a pasta com os arquivos..." readonly />

      <button id="btnSelectEntrada" class="btn-icon" title="Selecionar entrada" type="button">
        <img
          class="btn-ico"
          src="../assets/icones/ic_folder-24-outline-white.svg"
          alt=""
          aria-hidden="true"
        />
      </button>
    </div>
    <div class="hint">Selecione uma pasta ou um arquivo .zip contendo os XMLs de entrada.</div>

    <h4>Diretório de Destino (Onde salvar)</h4>
    <div class="path-row">
      <input id="saidaLabel" class="path-input" type="text" placeholder="Selecione a pasta de saída..." readonly />

      <button id="btnSelectSaida" class="btn-icon" title="Selecionar saída" type="button">
        <img
          class="btn-ico"
          src="../assets/icones/ic_folder-24-outline-white.svg"
          alt=""
          aria-hidden="true"
        />
      </button>
    </div>
    <div class="hint">Essa pasta receberá os relatórios gerados pelo parser.</div>

    <h4>Nome do relatório (opcional)</h4>
    <div class="path-row">
      <input
        id="nomeSaida"
        class="path-input"
        type="text"
        placeholder="Ex.: IMPO1_Dezembro_2025"
        autocomplete="off"
      />

      <button id="btnLimparNome" class="btn-icon" title="Limpar nome" type="button">
        <span style="font-size:18px; line-height:1; color:#fff;">×</span>
      </button>
    </div>

    <!-- Botões extras -->
    <div class="actions">
      <button id="btnAbrir" class="btn-primary" type="button">Abrir pasta de saída</button>
    </div>

    <!-- Tipo de parser -->
    <fieldset class="fieldset-parser">
      <legend>Tipo de Parser</legend>
      <label><input type="radio" name="parser" value="NFE" checked> NFE</label>
      <label><input type="radio" name="parser" value="IMPO1"> IMPO1</label>
      <label><input type="radio" name="parser" value="IMPO8"> IMPO8</label>
      <label><input type="radio" name="parser" value="SPED"> SPED</label>
      <label><input type="radio" name="parser" value="BASE"> BASE REINTEGRA</label>
    </fieldset>

    <!-- Controles -->
    <div class="buttons-bottom">
      <button id="btnSalvar" class="btn-secondary" type="button">Salvar configurações de entrada e saída</button>
      <button id="btnLimpar" class="btn-secondary" type="button">Limpar configurações</button>

      <button id="btnIniciar" class="btn-executar" type="button">
        <img
          class="btn-ico-play"
          src="../assets/icones/ic_play-24-outline-white.svg"
          alt=""
          aria-hidden="true"
        />
        Executar Parser
      </button>
    </div>

  </div>

  <!-- POPUP DE RESUMO -->
  <div id="popupResumo" class="popup-resumo" style="display:none;">
    <div class="popup-content">
      <h3>Resumo da execução</h3>
      <p><strong>Status:</strong> <span id="resStatus">—</span></p>
      <p><strong>Início:</strong> <span id="resInicio">—</span></p>
      <p><strong>Fim:</strong> <span id="resFim">—</span></p>
      <p><strong>Duração:</strong> <span id="resDuracao">—</span></p>
      <p><strong>Arquivos encontrados:</strong> <span id="resArq">—</span></p>
      <p><strong>Processados OK:</strong> <span id="resOk">—</span></p>
      <p><strong>Qtd. erros:</strong> <span id="resErros">—</span></p>

      <h4>Erros (se houver):</h4>
      <pre id="resListaErros">—</pre>

      <h4>Trecho do log:</h4>
      <pre id="resLog"></pre>

      <button id="btnFecharPopup" class="btn-secondary fechar" type="button">Fechar</button>
    </div>
  </div>

  <!-- MODAL DE CARREGAMENTO -->
  <div id="loadingOverlay" class="loading-overlay" style="display:none;">
    <div class="loading-box">
      <p id="progressCount" class="progress-count">—/—</p>
      <div class="spinner"></div>
      <p id="loadingText">Iniciando parser...</p>

      <div class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
      </div>

      <button id="btnCancelar" class="btn-secondary" type="button">Cancelar</button>
    </div>
  </div>

  <!-- MODAL AJUDA (VÍDEO) -->
<div id="helpVideoModal" class="help-modal" style="display:none;">
  <div class="help-modal-content" role="dialog" aria-modal="true" aria-label="Ajuda - Vídeo">
    <button id="btnFecharAjuda" class="help-close" type="button" aria-label="Fechar ajuda">×</button>

    <h3 style="margin-top:0;">Como funciona esta tela</h3>

    <div class="help-video-wrap">
      <video
        id="helpVideoPlayer"
        controls
        autoplay
        style="width:100%; height:100%; border-radius:12px;"
      >
        <source id="helpVideoSource" src="" type="video/mp4" />
        Seu navegador não suporta vídeo em MP4.
      </video>
    </div>
  </div>
</div>


  

  <script defer src="../scripts/main.js"></script>
  <script defer src="../scripts/router.js"></script>
  <script defer src="../scripts/src_parser.js"></script>
</body>
</html>
